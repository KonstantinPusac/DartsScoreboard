@page "/cricket/{gameCode}"
@namespace DartsScoreboard
@using Microsoft.AspNetCore.Components
@if (Loaded)
{

    <div class="container"> 
        <div class="score-table">
            <table>
                <thead>
                    <tr>
                        <th>Player</th>
                        <th>20</th>
                        <th>19</th>
                        <th>18</th>
                        <th>17</th>
                        <th>16</th>
                        <th>15</th>
                        <th>Bull</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var player in Players)
                    {
                        <tr class="@GetClass(player)">
                            <td>@player.Name</td>
                            @foreach (var score in player.Scores)
                            {
                                <td>
                                    @{
                                        int scoreCount = GetTableScore(player, score);
                                        var icon = GetSvgIcon(scoreCount);
                                    }
                                    @if (scoreCount > 0)
                                    {
                                        <span class="cricket-svg-icon" aria-hidden="true">@icon</span>
                                    }
                                </td>
                            }
                            <td>@(CalculatePoints(player))</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="bottom-section">
            <div class="info-row">
                <div class="info-box">Point Deficit: @CurrentPlayerDeficit</div>
                <div class="info-box">Marks: @CurrentPlayerMarks</div>
                <div class="info-box">Current Throw: @CurrentThrowPoints</div>
            </div>

            <div class="statistics">
                @* Your statistics content goes here *@
                <p>Statistics: @StatisticsSummary</p>
            </div>

            <div class="keyboard-wrapper">
                <Keyboard KeyboardParameters="KeyboardParameters" KeyClick="KeyboardClick" />
            </div>
        </div>
    </div>
}

@code {
    private int CurrentPlayerDeficit = 0;
    private int CurrentPlayerMarks = 0;
    private int CurrentThrowPoints = 0;
    private string StatisticsSummary = "";

    private static string SanitizeSvg(string svg)
    {
        // Normalize tag and attribute spacing from stored strings
        return svg
            .Replace("< svg", "<svg")
            .Replace("</ svg", "</svg")
            .Replace("< line", "<line")
            .Replace("< circle", "<circle")
            .Replace("stroke - width", "stroke-width")
            .Replace(" = ", "=")
            .Replace("> ", ">")
            .Replace(" <", "<");
    }

    private MarkupString GetSvgIcon(int scoreCount)
    {
        return scoreCount switch
        {
            1 => new MarkupString(SanitizeSvg(CricketIcons.OneMark)),
            2 => new MarkupString(SanitizeSvg(CricketIcons.TwoMarks)),
            >= 3 => new MarkupString(SanitizeSvg(CricketIcons.ThreeMarks)),
            _ => default
        };
    }
}                                       